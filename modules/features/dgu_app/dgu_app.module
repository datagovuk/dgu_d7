<?php
/**
 * @file
 * Drupal needs this blank file.
 */

include_once 'dgu_app.features.inc';

/**
 * Implements hook_form_BASE_FORM_ID_alter().
 * Add boxed class and change page title on app node form.
 */
function dgu_app_form_node_form_alter(&$form, &$form_state, $form_id) {
  if ($form_id == 'app_node_form') {
    $form['#attributes']['class'][] = 'boxed';
    drupal_set_title(t('Submit an app'));
  }
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function dgu_app_form_app_node_form_alter(&$form, &$form_state, $form_id) {

  $form['revision_information']['#type'] = 'hidden';

  $form['actions']['publish']['#access'] = TRUE;
  $form['actions']['publish']['#value'] = 'Submit for moderation';
  $form['actions']['publish']['#type'] = 'submit';
  $form['actions']['publish']['#weight'] = 6;
  $form['actions']['publish']['#submit'] = $form['actions']['submit']['#submit'];

  $form['actions']['submit']['#value'] = 'Save draft';
  $form['#submit'][] = 'dgu_app_node_submit';

  unset($form['actions']['preview_changes']);

}

/**
 * Custom submit function for challenge content type.
 */
function dgu_app_node_submit($form, &$form_state) {
  if(isset($form_state['clicked_button'])) {
    if ($form_state['clicked_button']['#value'] == "Submit for moderation") {
      $form_state['values']['workbench_moderation_state_new'] = 'needs_review';
    }
    elseif ($form_state['clicked_button']['#value'] == "Save draft") {
      $form_state['values']['workbench_moderation_state_new'] = 'draft';
    }
  }
}
